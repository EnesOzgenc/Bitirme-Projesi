<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <title>Klavye HÄ±z Testi</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 20px;
      transition: background 0.3s, color 0.3s, opacity 0.5s ease;
    }
    /* Gece/GÃ¼ndÃ¼z Tema - YazÄ± Rengi GÃ¼ncellendi */
    body.light {
      background: #f2f2f2;
      color: #333333;
    }
    body.dark {
      background: #111;
      color: #EDEDED;
    }
    .container {
      max-width: 800px;
      margin: auto;
      padding: 20px;
      border-radius: 10px;
      transition: background 0.3s;
    }
    .container.light {
      background: #fff;
    }
    .container.dark {
      background: #222;
    }
    textarea {
      width: 100%;
      height: 200px;
      font-size: 16px;
      padding: 10px;
      margin-top: 10px;
      resize: none;
      transition: background 0.3s, color 0.3s;
    }
    textarea.light {
      background: #fff;
      color: #000;
    }
    textarea.dark {
      background: #333;
      color: #FFD700;
    }
    .header {
      text-align: center;
      font-size: 28px;
      font-weight: bold;
      margin-bottom: 10px;
    }
    .controls {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }
    .controls label {
      font-size: 16px;
      margin-right: 10px;
    }
    .controls select {
      font-size: 16px;
      padding: 5px;
      transition: background 0.3s, color 0.3s;
    }
    .controls select.light {
      background-color: #fff;
      color: #000;
    }
    .controls select.dark {
      background-color: #000;
      color: #FFD700;
      border: 1px solid #FFD700;
    }
    /* GeÃ§iÅŸ Animasyonu */
    .fade-out {
      opacity: 0;
    }
    /* SaÄŸ alt kÃ¶ÅŸede Navigasyon Butonu (Logo TarzÄ±) */
    .nav-button {
      position: fixed;
      bottom: 10px;
      right: 10px;
      z-index: 1000;
      padding: 10px 20px;
      font-size: 18px;
      background-color: #000000;
      color: #ffffff;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      transition: background-color 0.3s, transform 0.3s;
      box-shadow: 0px 4px 8px rgba(0,0,0,0.2);
    }
    .nav-button:hover {
      background-color: #1e40af;
      transform: scale(1.05);
    }
    /* Sol Ã¼stte Tema Toggle Butonu */
    .theme-toggle {
      position: fixed;
      top: 30px;
      left: 10px;
      z-index: 1000;
      padding: 10px 15px;
      font-size: 20px;
      background: none;
      border: none;
      cursor: pointer;
      transition: color 0.3s;
    }
  </style>
</head>
<body class="light">
  <!-- SaÄŸ alt navigasyon butonu (logo tarzÄ±nda) -->
  <button class="nav-button" id="navToGame">âŒ¨ Oyun</button>
  <!-- Sol Ã¼st tema toggle butonu -->
  <button class="theme-toggle" id="themeToggle">ğŸŒ™</button>

  <div class="container light" id="mainContainer">
    <div class="header">Klavye HÄ±z Testi</div>
    <div class="controls">
      <div style="display: flex; align-items: center;">
        <label for="timeSelect">SÃ¼re SeÃ§in:</label>
        <select id="timeSelect" class="light">
          <option value="30">30 Saniye</option>
          <option value="60">1 Dakika</option>
          <option value="180">3 Dakika</option>
          <option value="300">5 Dakika</option>
          <option value="600">10 Dakika</option>
        </select>
      </div>
    </div>
    <div class="timer-row">
      <div>Kalan SÃ¼re: <span id="countdown">--:--</span></div>
      <button id="restartBtn" title="Yeniden BaÅŸla">â†»</button>
    </div>
    <p id="testText">
      Bilgisayar kullanÄ±mÄ± gÃ¼nÃ¼mÃ¼zde oldukÃ§a yaygÄ±nlaÅŸtÄ±. Klavye ile hÄ±zlÄ± yazÄ± yazmak, Ã¶zellikle ofis Ã§alÄ±ÅŸanlarÄ± iÃ§in bÃ¼yÃ¼k Ã¶nem taÅŸÄ±r. DoÄŸru yazÄ±m kurallarÄ±na dikkat ederek, akÄ±cÄ± bir ÅŸekilde metin yazmak hem zaman kazandÄ±rÄ±r hem de profesyonellik saÄŸlar. Yazma pratiÄŸi yapmak isteyenler iÃ§in Ã§eÅŸitli uygulamalar geliÅŸtirilmiÅŸtir. Bu uygulamalar, kullanÄ±cÄ±larÄ±n hÄ±zÄ±nÄ± ve doÄŸruluÄŸunu Ã¶lÃ§er. Ne kadar Ã§ok pratik yapÄ±lÄ±rsa, yazma becerisi o kadar geliÅŸir. Klavye dÃ¼zeni, parmak pozisyonlarÄ± ve dikkat unsurlarÄ± verimli yazma sÃ¼recinde Ã¶nemli rol oynar. Her gÃ¼n birkaÃ§ dakika dÃ¼zenli olarak Ã§alÄ±ÅŸmak, bÃ¼yÃ¼k ilerlemeler saÄŸlar.
    </p>
    <textarea id="userInput"></textarea>
    <div class="stats">
      <p>YazÄ±lan Kelime SayÄ±sÄ±: <span id="wordCount">0</span></p>
      <p>Yazma HÄ±zÄ± (WPM): <span id="wpm">0</span></p>
      <p>VuruÅŸ HÄ±zÄ± (CPM): <span id="cpm">0</span></p>
      <p>Hata SayÄ±sÄ±: <span id="errorCount">0</span></p>
    </div>
    <div class="resultText" id="resultText"></div>
  </div>

  <script>
    // Tema Uygulama Fonksiyonu
    function applyTheme(theme) {
      if (theme === 'dark') {
        document.body.classList.remove('light');
        document.body.classList.add('dark');
        mainContainer.classList.remove('light');
        mainContainer.classList.add('dark');
        userInput.classList.remove('light');
        userInput.classList.add('dark');
        timeSelect.classList.remove('light');
        timeSelect.classList.add('dark');
        themeToggle.textContent = "â˜€";
        themeToggle.style.color = "yellow";
        // Navigasyon butonu gÃ¼ncellemesi: Dark modda -> arka plan beyaz, yazÄ± siyah.
        document.getElementById("navToGame").style.backgroundColor = "#ffffff";
        document.getElementById("navToGame").style.color = "#000000";
      } else {
        document.body.classList.remove('dark');
        document.body.classList.add('light');
        mainContainer.classList.remove('dark');
        mainContainer.classList.add('light');
        userInput.classList.remove('dark');
        userInput.classList.add('light');
        timeSelect.classList.remove('dark');
        timeSelect.classList.add('light');
        themeToggle.textContent = "ğŸŒ™";
        themeToggle.style.color = "black";
        // Navigasyon butonu gÃ¼ncellemesi: Light modda -> arka plan siyah, yazÄ± beyaz.
        document.getElementById("navToGame").style.backgroundColor = "#000000";
        document.getElementById("navToGame").style.color = "#ffffff";
      }
    }
    const storedTheme = localStorage.getItem('theme') || 'light';
    document.body.className = storedTheme;
    const mainContainer = document.getElementById('mainContainer');
    const userInput = document.getElementById('userInput');
    const timeSelect = document.getElementById('timeSelect');
    const themeToggle = document.getElementById('themeToggle');
    applyTheme(storedTheme);
    
    themeToggle.addEventListener("click", () => {
      const currentTheme = localStorage.getItem('theme') || 'light';
      const newTheme = currentTheme === 'light' ? 'dark' : 'light';
      applyTheme(newTheme);
      localStorage.setItem('theme', newTheme);
    });

    document.getElementById("navToGame").addEventListener("click", function() {
      document.body.classList.add('fade-out');
      setTimeout(function() {
        window.location.href = "f_klavye_oyunu.html";
      }, 500);
    });

    let countdown;
    let timeLeft = 0;
    let timerStarted = false;
    const countdownDisplay = document.getElementById("countdown");
    const resultDiv = document.getElementById("resultText");
    let wordsArray = [];

    window.onload = function() {
      document.body.classList.remove('fade-out');
      const testTextElem = document.getElementById("testText");
      const rawText = testTextElem.innerText.trim();
      wordsArray = rawText.split(/\s+/);
      testTextElem.innerHTML = wordsArray.map((word, i) => `<span class="word" data-index="${i}">${word}</span>`).join(" ");
    };

    userInput.addEventListener("input", () => {
      if (!timerStarted) {
        startTimer();
        timerStarted = true;
      }
      updateCurrentWordIndicator();
    });

    function startTimer() {
      timeLeft = parseInt(timeSelect.value);
      updateCountdownDisplay();
      countdown = setInterval(() => {
        timeLeft--;
        updateCountdownDisplay();
        if (timeLeft <= 0) {
          clearInterval(countdown);
          userInput.disabled = true;
          calculateStats();
        }
      }, 1000);
    }

    function updateCountdownDisplay() {
      const mins = Math.floor(timeLeft / 60);
      const secs = timeLeft % 60;
      countdownDisplay.textContent = `${String(mins).padStart(2, "0")}:${String(secs).padStart(2, "0")}`;
    }

    function updateCurrentWordIndicator() {
      const userWords = userInput.value.split(/\s+/);
      let currentIndex = userWords.length - 1;
      const typedWord = userWords[userWords.length - 1] || "";
      document.querySelectorAll("#testText .word").forEach(span => {
         span.style.textDecoration = "";
         span.style.textUnderlineOffset = "";
         span.style.color = "";
      });
      if (currentIndex < wordsArray.length) {
         const currentSpan = document.querySelector(`#testText .word[data-index="${currentIndex}"]`);
         if (currentSpan) {
           currentSpan.style.textDecoration = "underline";
           currentSpan.style.textUnderlineOffset = "2px";
           if (typedWord !== "" && !wordsArray[currentIndex].toLowerCase().startsWith(typedWord.toLowerCase())) {
             currentSpan.style.color = "red";
           }
         }
      }
    }

    function calculateStats() {
      const userText = userInput.value.trim();
      const originalText = wordsArray.join(" ");
      const originalWords = originalText.split(/\s+/);
      const userWords = userText.split(/\s+/);
      let totalErrors = 0;
      let resultHTML = '';
      const punctuations = [".", ",", ";", ":", "!", "?", "â€”", "-", "â€¦"];
      for (let i = 0; i < originalWords.length; i++) {
        const original = originalWords[i] || "";
        const user = userWords[i] || "";
        const lastChar = original.slice(-1);
        const isPunctuation = punctuations.includes(lastChar);
        const baseWord = isPunctuation ? original.slice(0, -1) : original;
        if (i === userWords.length - 1 && !user.endsWith(lastChar) && baseWord.startsWith(user)) {
          resultHTML += `<span class="correct">${user} </span>`;
          break;
        }
        if (original === user) {
          resultHTML += `<span class="correct">${user} </span>`;
        } else if (user === baseWord && isPunctuation) {
          resultHTML += `<span class="correct">${user}</span><span class="punc-error">${lastChar}</span> `;
          totalErrors++;
        } else if (user.startsWith(baseWord)) {
          resultHTML += `<span class="correct">${user} </span>`;
        } else if (user === "") {
          continue;
        } else {
          resultHTML += `<span class="wrong">${user} </span>`;
          totalErrors++;
        }
      }
      const wordCount = userWords.filter(w => w.trim() !== "").length;
      const charCount = userText.length;
      const selectedTime = parseInt(timeSelect.value);
      const wpm = Math.round((wordCount / selectedTime) * 60);
      const cpm = Math.round((charCount / selectedTime) * 60);
      document.getElementById("wordCount").textContent = wordCount;
      document.getElementById("wpm").textContent = wpm;
      document.getElementById("cpm").textContent = cpm;
      document.getElementById("errorCount").textContent = totalErrors;
      resultDiv.innerHTML = "<hr><strong>YazdÄ±ÄŸÄ±nÄ±z Metin (Hatalar kÄ±rmÄ±zÄ±):</strong><br><br>" + resultHTML;
    }

    restartBtn.addEventListener("click", () => {
      clearInterval(countdown);
      timeLeft = 0;
      timerStarted = false;
      userInput.disabled = false;
      userInput.value = "";
      document.getElementById("countdown").textContent = "--:--";
      document.getElementById("wordCount").textContent = "0";
      document.getElementById("wpm").textContent = "0";
      document.getElementById("cpm").textContent = "0";
      document.getElementById("errorCount").textContent = "0";
      resultDiv.innerHTML = "";
    });
  </script>
</body>
</html>
